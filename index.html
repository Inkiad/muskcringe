<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>where's elon? | imcringe.com</title>
    <meta name="description" content="Live tracking of Elon Musk's private jets using public flight data">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Trebuchet MS', Arial, sans-serif;
            background: #000080;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,.03) 2px, rgba(255,255,255,.03) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,.03) 2px, rgba(255,255,255,.03) 4px);
            color: #ffff00;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border: 3px ridge #c0c0c0;
            background: linear-gradient(180deg, #0000ff 0%, #000080 100%);
            box-shadow: 5px 5px 0px #000000;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #00ff00;
            text-shadow: 2px 2px #ff00ff, 4px 4px #00ffff;
            letter-spacing: 2px;
        }

        .blink {
            animation: blink 1s steps(2, start) infinite;
        }

        @keyframes blink {
            to { visibility: hidden; }
        }

        .subtitle {
            color: #00ffff;
            font-size: 1.1em;
            margin-top: 10px;
        }

        .subtitle a {
            color: #ff00ff;
            text-decoration: none;
            font-weight: bold;
        }

        .subtitle a:hover {
            text-decoration: underline;
            color: #ffff00;
        }

        .tracker-container {
            border: 3px ridge #c0c0c0;
            padding: 30px;
            background: #008080;
            box-shadow: 5px 5px 0px #000000;
            margin-bottom: 20px;
        }

        .status-bar {
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #ffff00;
            background: #000080;
            font-weight: bold;
            text-align: center;
        }

        .status-bar.loading {
            border-color: #00ffff;
            background: #000066;
            color: #00ffff;
        }

        .status-bar.error {
            border-color: #ff0000;
            background: #660000;
            color: #ff6666;
        }

        .status-bar.success {
            border-color: #00ff00;
            background: #006600;
            color: #00ff00;
        }

        .flight-card {
            border: 3px groove #c0c0c0;
            padding: 20px;
            margin: 20px 0;
            background: linear-gradient(180deg, #ffffff 0%, #c0c0c0 100%);
            color: #000000;
            box-shadow: 3px 3px 0px #000000;
        }

        .flight-card h3 {
            color: #000080;
            margin-bottom: 15px;
            font-size: 1.4em;
            text-decoration: underline;
        }

        .info-row {
            margin: 10px 0;
            line-height: 1.8;
        }

        .info-label {
            color: #800080;
            display: inline-block;
            width: 140px;
            font-weight: bold;
        }

        .info-value {
            color: #000000;
            font-weight: bold;
        }

        .flight-status {
            display: inline-block;
            padding: 5px 15px;
            border: 2px solid #000000;
            font-weight: bold;
        }

        .flight-status.airborne {
            background: #00ff00;
            color: #000000;
        }

        .flight-status.grounded {
            background: #ffff00;
            color: #000000;
        }

        .controls {
            text-align: center;
            margin-top: 25px;
        }

        button {
            background: linear-gradient(180deg, #ffffff 0%, #c0c0c0 100%);
            color: #000000;
            border: 3px outset #c0c0c0;
            padding: 12px 30px;
            font-family: 'Comic Sans MS', Arial, sans-serif;
            font-size: 1.1em;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 3px 3px 0px #000000;
        }

        button:hover {
            background: linear-gradient(180deg, #ffff00 0%, #ffcc00 100%);
        }

        button:active {
            border-style: inset;
            box-shadow: 1px 1px 0px #000000;
            transform: translate(2px, 2px);
        }

        .map-link {
            color: #0000ff;
            text-decoration: underline;
            font-weight: bold;
        }

        .map-link:visited {
            color: #800080;
        }

        .map-link:hover {
            color: #ff0000;
        }

        .last-update {
            text-align: center;
            color: #ffff00;
            font-size: 0.9em;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #ffff00;
            font-weight: bold;
        }

        .no-flights {
            text-align: center;
            padding: 40px;
            color: #000000;
            font-style: italic;
            background: #ffff00;
            border: 3px dashed #ff0000;
            font-weight: bold;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #00ffff;
            font-size: 0.9em;
            border-top: 2px solid #00ffff;
        }

        footer a {
            color: #00ff00;
            text-decoration: none;
            font-weight: bold;
        }

        footer a:hover {
            color: #ffff00;
            text-decoration: underline;
        }

        .under-construction {
            text-align: center;
            margin: 20px 0;
        }

        .under-construction img {
            width: 100px;
            image-rendering: pixelated;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8em;
            }
            
            .info-label {
                display: block;
                width: 100%;
                margin-bottom: 5px;
            }

            button {
                width: 100%;
            }
        }

        marquee {
            background: #ff0000;
            color: #ffff00;
            padding: 10px;
            margin: 20px 0;
            border: 2px solid #000000;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ©Ô∏è WHERE'S ELON? üõ©Ô∏è</h1>
            <div class="subtitle">
                <span class="blink">‚ö†Ô∏è LIVE ‚ö†Ô∏è</span> Flight Tracker
            </div>
            <div class="subtitle" style="font-size: 0.9em; margin-top: 10px;">
                <a href="https://imcringe.com">imcringe.com</a> | Est. 2024
            </div>
        </header>

        <marquee behavior="scroll" direction="left">
            ‚ò∫ REAL-TIME FLIGHT DATA ‚ò∫ UPDATED FROM PUBLIC ADS-B TRANSMISSIONS ‚ò∫ ALL DATA IS LEGALLY AVAILABLE VIA FAA ‚ò∫
        </marquee>

        <div class="tracker-container">
            <div id="status" class="status-bar loading">
                üîÑ Initializing flight tracker...
            </div>

            <div id="flights"></div>

            <div class="controls">
                <button onclick="refreshData()">üîÑ REFRESH DATA</button>
            </div>

            <div class="last-update" id="lastUpdate"></div>
        </div>

        <footer>
            <p>‚ö° Powered by <a href="https://opensky-network.org" target="_blank">OpenSky Network</a> ‚ö°</p>
            <p style="margin-top: 10px;">All flight data is publicly available via FAA/ADS-B transmissions</p>
            <p style="margin-top: 10px; font-size: 0.8em;">
                <span class="blink">‚òÖ</span> Best viewed in Netscape Navigator <span class="blink">‚òÖ</span>
            </p>
        </footer>
    </div>

    <script>
        // Known aircraft ICAO24 codes
        const AIRCRAFT = [
            { 
                icao24: 'a03d2e', 
                name: 'Private Jet',
                registration: 'TBD'
            },
            { 
                icao24: 'a835af', 
                name: 'Gulfstream G650ER',
                registration: 'N628TS'
            },
            // Add more as you find them
        ];

        async function refreshData() {
            const statusEl = document.getElementById('status');
            const flightsEl = document.getElementById('flights');
            const updateEl = document.getElementById('lastUpdate');

            statusEl.className = 'status-bar loading';
            statusEl.innerHTML = 'üîÑ Fetching live flight data...';
            flightsEl.innerHTML = '';

            try {
                let foundFlights = false;
                let recentFlights = [];

                for (const aircraft of AIRCRAFT) {
                    // Try ADS-B Exchange API first (more open)
                    const adsbUrl = `https://adsbexchange.com/api/aircraft/icao/${aircraft.icao24}/`;
                    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(adsbUrl)}`;
                    
                    try {
                        const response = await fetch(proxyUrl);
                        
                        if (!response.ok) {
                            console.error(`HTTP ${response.status} for ${aircraft.icao24}`);
                            // If ADSB fails, try OpenSky as backup
                            await tryOpenSky(aircraft, flightsEl, foundFlights);
                            await fetchRecentFlight(aircraft, recentFlights);
                            continue;
                        }

                        const data = await response.json();

                        // ADSB Exchange data format
                        if (data && data.ac && data.ac.length > 0) {
                            foundFlights = true;
                            const ac = data.ac[0]; // First aircraft in array
                            
                            const flightCard = createFlightCard({
                                aircraft,
                                callsign: ac.flight ? ac.flight.trim() : 'N/A',
                                latitude: ac.lat || null,
                                longitude: ac.lon || null,
                                altitude: ac.alt_baro, // Already in feet
                                velocity: ac.gs ? ac.gs / 1.944 : null, // Convert knots to m/s for consistency
                                onGround: ac.alt_baro === "ground",
                                lastContact: Math.floor(Date.now() / 1000) - (ac.seen || 0),
                                verticalRate: ac.baro_rate ? ac.baro_rate / 196.85 : null, // Convert fpm to m/s
                                heading: ac.track || null,
                                isHistorical: false
                            });

                            flightsEl.innerHTML += flightCard;
                        } else {
                            // No current flight in ADSB, try OpenSky as backup
                            await tryOpenSky(aircraft, flightsEl, foundFlights);
                            await fetchRecentFlight(aircraft, recentFlights);
                        }
                    } catch (error) {
                        console.error(`Error fetching ${aircraft.icao24}:`, error);
                        await fetchRecentFlight(aircraft, recentFlights);
                    }

                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

                if (foundFlights) {
                    statusEl.className = 'status-bar success';
                    statusEl.innerHTML = '‚úÖ LIVE FLIGHT DATA LOADED!';
                } else if (recentFlights.length > 0) {
                    statusEl.className = 'status-bar';
                    statusEl.innerHTML = '‚ö†Ô∏è NO ACTIVE FLIGHTS - SHOWING MOST RECENT DATA';
                    // Display the most recent flight
                    flightsEl.innerHTML = recentFlights[0];
                } else {
                    statusEl.className = 'status-bar';
                    statusEl.innerHTML = '‚ö†Ô∏è NO FLIGHT DATA AVAILABLE';
                    flightsEl.innerHTML = '<div class="no-flights">No current or recent flight data available for tracked aircraft.</div>';
                }

                updateEl.innerHTML = `‚è∞ Last updated: ${new Date().toLocaleString()} ‚è∞`;

            } catch (error) {
                statusEl.className = 'status-bar error';
                statusEl.innerHTML = `‚ùå ERROR: ${error.message}`;
                flightsEl.innerHTML = '<div class="no-flights">Unable to fetch flight data. Please try again later.</div>';
                updateEl.innerHTML = `Last attempt: ${new Date().toLocaleString()}`;
            }
        }

        async function tryOpenSky(aircraft, flightsEl, foundFlights) {
            try {
                const apiUrl = `https://opensky-network.org/api/states/all?icao24=${aircraft.icao24}`;
                const url = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`;
                
                const response = await fetch(url);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.states && data.states.length > 0) {
                        foundFlights = true;
                        const state = data.states[0];
                        
                        const [
                            icao24, callsign, origin_country, time_position,
                            last_contact, longitude, latitude, baro_altitude,
                            on_ground, velocity, true_track, vertical_rate
                        ] = state;

                        const flightCard = createFlightCard({
                            aircraft,
                            callsign: callsign ? callsign.trim() : 'N/A',
                            latitude,
                            longitude,
                            altitude: baro_altitude,
                            velocity,
                            onGround: on_ground,
                            lastContact: last_contact,
                            verticalRate: vertical_rate,
                            heading: true_track,
                            isHistorical: false
                        });

                        flightsEl.innerHTML += flightCard;
                        return true;
                    }
                }
            } catch (error) {
                console.error(`OpenSky backup failed for ${aircraft.icao24}:`, error);
            }
            return false;
        }

        async function fetchRecentFlight(aircraft, recentFlights) {
            try {
                // OpenSky historical flight API requires authentication
                // Instead, we'll store the last known state when we do find an active flight
                // For now, just show a message that no flights are active
                console.log(`No historical data available for ${aircraft.icao24} (API requires authentication)`);
                
                // Create a placeholder card showing the aircraft is being tracked
                const flightCard = `
                    <div class="flight-card">
                        <h3>${aircraft.name} (${aircraft.registration})</h3>
                        <div style="background: #ffff00; padding: 10px; margin-bottom: 15px; border: 2px dashed #000000; text-align: center;">
                            <strong>‚ö†Ô∏è AIRCRAFT CURRENTLY GROUNDED ‚ö†Ô∏è</strong>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span class="flight-status grounded">üõ¨ NO ACTIVE FLIGHTS</span>
                        </div>

                        <div class="info-row">
                            <span class="info-label">ICAO24:</span>
                            <span class="info-value">${aircraft.icao24.toUpperCase()}</span>
                        </div>

                        <div class="info-row">
                            <span class="info-value" style="font-style: italic;">
                                This aircraft is being monitored. Data will appear when flight becomes active.
                            </span>
                        </div>
                    </div>
                `;
                
                recentFlights.push(flightCard);
            } catch (error) {
                console.error(`Error in fetchRecentFlight for ${aircraft.icao24}:`, error);
            }
        }

        function createFlightCard(flight) {
            const altitudeFeet = flight.altitude ? Math.round(flight.altitude * 3.281) : null;
            const altitudeMeters = flight.altitude ? Math.round(flight.altitude) : null;
            const speedKnots = flight.velocity ? Math.round(flight.velocity * 1.944) : null;
            const speedMph = flight.velocity ? Math.round(flight.velocity * 2.237) : null;
            const timeSince = flight.lastContact ? Math.round((Date.now() / 1000) - flight.lastContact) : null;
            const verticalRateFpm = flight.verticalRate ? Math.round(flight.verticalRate * 196.85) : null;

            const statusClass = flight.onGround ? 'grounded' : 'airborne';
            const statusIcon = flight.onGround ? 'üõ¨' : '‚úàÔ∏è';
            const statusText = flight.onGround ? 'ON GROUND' : 'IN FLIGHT';

            if (flight.isHistorical) {
                const flightDate = new Date(flight.lastSeen * 1000);
                const duration = flight.lastSeen - flight.firstSeen;
                const hours = Math.floor(duration / 3600);
                const minutes = Math.floor((duration % 3600) / 60);
                
                return `
                    <div class="flight-card">
                        <h3>${flight.aircraft.name} (${flight.aircraft.registration})</h3>
                        <div style="background: #ffff00; padding: 10px; margin-bottom: 15px; border: 2px dashed #000000; text-align: center;">
                            <strong>‚ö†Ô∏è HISTORICAL DATA - MOST RECENT FLIGHT ‚ö†Ô∏è</strong>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span class="flight-status grounded">üõ¨ ON GROUND</span>
                        </div>

                        <div class="info-row">
                            <span class="info-label">Callsign:</span>
                            <span class="info-value">${flight.callsign}</span>
                        </div>

                        <div class="info-row">
                            <span class="info-label">Last Flight:</span>
                            <span class="info-value">${flightDate.toLocaleString()}</span>
                        </div>

                        <div class="info-row">
                            <span class="info-label">Flight Duration:</span>
                            <span class="info-value">${hours}h ${minutes}m</span>
                        </div>

                        ${flight.departureAirport !== 'Unknown' ? `
                        <div class="info-row">
                            <span class="info-label">Departure:</span>
                            <span class="info-value">${flight.departureAirport}</span>
                        </div>
                        ` : ''}

                        ${flight.arrivalAirport !== 'Unknown' ? `
                        <div class="info-row">
                            <span class="info-label">Arrival:</span>
                            <span class="info-value">${flight.arrivalAirport}</span>
                        </div>
                        ` : ''}

                        ${timeSince ? `
                        <div class="info-row">
                            <span class="info-label">Time Since:</span>
                            <span class="info-value">${Math.floor(timeSince / 3600)} hours ago</span>
                        </div>
                        ` : ''}
                    </div>
                `;
            }

            return `
                <div class="flight-card">
                    <h3>${flight.aircraft.name} (${flight.aircraft.registration})</h3>
                    
                    <div class="info-row">
                        <span class="info-label">Status:</span>
                        <span class="flight-status ${statusClass}">${statusIcon} ${statusText}</span>
                    </div>

                    <div class="info-row">
                        <span class="info-label">Callsign:</span>
                        <span class="info-value">${flight.callsign}</span>
                    </div>

                    ${flight.latitude && flight.longitude ? `
                    <div class="info-row">
                        <span class="info-label">Position:</span>
                        <span class="info-value">${flight.latitude.toFixed(4)}¬∞, ${flight.longitude.toFixed(4)}¬∞</span>
                    </div>
                    ` : ''}

                    ${altitudeFeet ? `
                    <div class="info-row">
                        <span class="info-label">Altitude:</span>
                        <span class="info-value">${altitudeFeet.toLocaleString()} ft (${altitudeMeters.toLocaleString()} m)</span>
                    </div>
                    ` : ''}

                    ${speedKnots ? `
                    <div class="info-row">
                        <span class="info-label">Speed:</span>
                        <span class="info-value">${speedKnots} knots (${speedMph} mph)</span>
                    </div>
                    ` : ''}

                    ${flight.heading !== null && flight.heading !== undefined ? `
                    <div class="info-row">
                        <span class="info-label">Heading:</span>
                        <span class="info-value">${Math.round(flight.heading)}¬∞</span>
                    </div>
                    ` : ''}

                    ${verticalRateFpm && !flight.onGround ? `
                    <div class="info-row">
                        <span class="info-label">Vertical Rate:</span>
                        <span class="info-value">${verticalRateFpm > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(verticalRateFpm)} ft/min</span>
                    </div>
                    ` : ''}

                    ${timeSince ? `
                    <div class="info-row">
                        <span class="info-label">Last Contact:</span>
                        <span class="info-value">${timeSince} seconds ago</span>
                    </div>
                    ` : ''}

                    ${flight.latitude && flight.longitude ? `
                    <div class="info-row">
                        <span class="info-label">Map:</span>
                        <a href="https://www.google.com/maps?q=${flight.latitude},${flight.longitude}" 
                           target="_blank" 
                           class="map-link">
                           üìç Click here to view on Google Maps!
                        </a>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // Initial load
        window.addEventListener('load', () => {
            refreshData();
        });
    </script>
</body>
</html>
